<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Producto</title>
  <link rel="icon" href="src/EnmaManualidadesLogo.png">
  <link rel="shortcut icon" href="src/EnmaManualidadesLogoMini.png">
  <link rel="stylesheet" href="styles.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #4d004d;
      color: white;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #4d004d;
    }
    .main-container {
      display: flex;
      gap: 20px;
      padding: 20px;
      justify-content: center;
      align-items: center;
    }

    .preview-container {
      position: relative;
      background-color: #8c004c;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .preview {
      position: relative;
      display: inline-block;
    }

    .preview img {
      max-width: 300px;
    }

    .design-preview {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      width: 100px;
    }

    .control-panel {
      background-color: #8c004c;
      padding: 20px;
      border-radius: 10px;
      width: 300px;
    }

    .control-panel label,
    .control-panel input {
      display: block;
      margin-bottom: 10px;
      width: 100%;
    }

    .control-panel button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      background-color: #ff0066;
      border: none;
      color: white;
      border-radius: 5px;
    }
    .control-panel button:hover {
    background-color: #e6005c;
  }

    main {
    display: flex;
    flex-direction: row;
    align-items: center;
    border-radius: 10px;
    flex-wrap: nowrap;
}
.product-detail {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
  padding: 20px;
  border-radius: 10px;
  background: linear-gradient(95.4deg, rgb(156 100 137) 0%, rgb(156 156 156) 100%);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  text-align: center;
  margin: 10px;
  color: black;
}

.logo {
    background-color: transparent;
    border: none;
    cursor: pointer;
    margin-left: 40%;
}
  
.logo img {
    width: 25%;
    height: 100%;
    object-fit: contain;
}
header {
    display: flex;
    justify-content: space-between;
    width: 100%;
    padding: 10px 20px;
    background-color: rgba(0, 0, 0, 0.2);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    flex-wrap: nowrap;
    flex-direction: row;
}

.img_producto{

    height: 400px;
    object-fit: cover;
}

#back-to-store {
  background-color: #800080;
  color: white;
  border: none;
  display: flex
;
  justify-content: center;
  align-items: center;
  padding: 10px;
  border-radius: 20px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  transition: background-color 0.3s ease;
}
  
  #back-to-store:hover {
    background-color: #aa00aa;
  }
  
  .cart-icon {
    font-size: 20px;
  }
  
  .tags {
    display: flex;
    gap: 5px;
    justify-content: center;
    margin-top: 10px;
  }
  
  .tag {
    background-color: #800080;
    color: #fff;
    border-radius: 10px;
    padding: 5px 10px;
    font-size: 12px;
  }
  
  .hidden {
    display: none;
  }
  
  /* Carrito */
  #cart-popup {
    position: fixed;
    top: 20%;
    right: 20px;
    background: #fff;
    color: #000;
    width: 300px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    padding: 20px;
  }
  
  #cart-popup h3 {
    margin: 0 0 10px;
  }


  .product-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: flex-start;
    gap: 20px;
    padding: 20px;
  }
  
  .product-gallery {
    max-width: 400px;
    text-align: center;
  }
  
  #main-image {
    max-width: 280px;
    border-radius: 10px;
    margin-bottom: 10px;
  }
  
  .thumbnail-gallery {
    display: flex;
    justify-content: center;
    gap: 5px;
  }
  
  .thumbnail-gallery img {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border: 2px solid #fff;
    border-radius: 5px;
    cursor: pointer;
    transition: transform 0.2s, border-color 0.2s;
  }
  
  .thumbnail-gallery img:hover {
    transform: scale(1.1);
    border-color: #ff0066;
  }
  
  .product-info {
    max-width: 400px;
  }
  
  h1 {
    font-size: 24px;
    color: #ff0066;
  }
  
  .price {
    font-size: 20px;
    color: #ffd700;
  }
  
  .cart-button {
    display: inline-block;
    background-color: #ff0066;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
  }
  
  .cart-button:hover {
    background-color: #e6005c;
  }
  
  #cart-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    color: #000;
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    position: relative;
    background-color: #681442;
    margin: 15% auto;
    padding: 20px;
    border-radius: 10px;
    width: 80%;
    margin-top: 100px;
    margin-bottom: 70px;
    max-width: 500px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  #close-modal {
    position: absolute;
    top: 10px;
    right: 20px;
    color: #000;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
  }

  #close-modal:hover {
    color: #ff0066;
  }

  /* Estilos del formulario */
  form {
    background: #8c004c;
    padding: 20px;
    border-radius: 10px;
    width: 100%;
    max-width: 500px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  form h2 {
    color: #fff;
    margin-bottom: 15px;
    text-align: center;
  }

  form label {
    display: block;
    color: #fff;
    margin-bottom: 5px;
  }

  form input[type="text"],
  form input[type="email"],
  form input[type="tel"],
  form select {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    background-color: #fff;
    color: #333;
    border: 2px solid #ccc;
    border-radius: 5px;
  }

  form select {
    cursor: pointer;
  }

  form input[type="text"]:focus,
  form input[type="email"]:focus,
  form input[type="tel"]:focus,
  form select:focus {
    border-color: #ff0066;
    outline: none;
  }

  form button {
    width: 100%;
    padding: 12px;
    background-color: #ff0066;
    color: white;
    border: none;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
  }

  form button:hover {
    background-color: #e6005c;
  }
  #design-preview {
  transition: all 0.2s ease; /* Añadido para que el movimiento y cambio de tamaño sean suaves */
}
#copy-url-button {
  background: none;      
  border: none;            
  color: white;          
  font-size: 16px;         
  cursor: pointer;
  padding: 5px 10px;
  transition: color 0.3s, transform 0.3s;
}

#copy-url-button:hover {
  color: #c7950c;          
  transform: scale(1.1);    
}

#copy-url-button i {
  margin-right: 8px;      
}
.ancord-nav {
  color: #ffff;
  transition: color 0.3s, transform 0.3s;
}
.ancord-nav i {
  margin-right: 8px;       
}
.ancord-nav:hover {
  transform: scale(1.1)!important;
  color: #c7950c !important;
}
#default-message {
  width: 100%;
  height: 60vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #ffffff;
  font-family: Arial, sans-serif;
  text-align: center;
}
  /* Estilo de la barra de carga */
  #loading-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%; /* Inicialmente está en 0% */
            height: 4px;
            background-color: #d39a2f; /* Azul claro */
            z-index: 9999;
            transition: width 1s ease-out; /* Transición suave para el aumento de la barra */
        }

        /* Estilos del contenido principal */
        #content {
            margin-top: 20px;
            padding: 20px;
        }
            /* Estilos para las partículas de nieve */

/* Estilos para pantallas grandes */
@media (min-width: 1130px) {
    #filters {
      position: fixed;
      width: 200px;
    }
    #menu-button {
        background-color: transparent;
        border: none;
        cursor: pointer;
      }
      
      #menu-button img {
        width: 20%;
        height: 100%;
        object-fit: contain;
      }
      footer {
        bottom: 0;
        height: 0;
        width: 100%;
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, 0.2);
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
        justify-content: space-evenly;
      }
    footer .footer-container {
      display: flex;
      align-items: center;
    }
    footer .footer-logo {
      margin-right: 20px;
    }
    footer .footer-info {
      align-items: center;
      gap: 10px;
    }
    footer .footer-info a {
      color: #fff;
      text-decoration: none;
    }
    footer p {
      margin: 0;
      font-size: 14px;
      color: #fff;
    }
    .iframefootermap{
      display: none;
    }
    #default-message {
      width: 100%;
      height: 60vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-family: Arial, sans-serif;
      text-align: center;
    }
  }
  
  /* Estilos para pantallas pequeñas */
  @media (max-width: 767px) {
    .logo img {
      width: 45%;
      height: 100%;
      object-fit: contain;
  }
    #filters {
      width: 100%;
      position: relative;
      margin: 10px 10px;
    }
    #menu-button {
        background-color: transparent;
        border: none;
        cursor: pointer;
      }
      
      #menu-button img {
        width: 45%;
        height: 100%;
        object-fit: contain;
      }
      footer {
        bottom: 0;
        height: 0;
        width: 100%;
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, 0.2);
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-wrap: wrap;
        flex-direction: row;
        justify-content: space-evenly;
      }
    footer .footer-container {
      display: flex;
      align-items: center;
    }
    footer .footer-logo {
      margin-right: 20px;
    }
    footer .footer-info {
      align-items: center;
      gap: 10px;
    }
    footer .footer-info a {
      color: #fff;
      text-decoration: none;
    }
    footer p {
      margin: 0;
      font-size: 14px;
      color: #fff;
    }
    .iframefootermap{
      display: none;
    }

    #products {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      padding: 20px;
      width: 100%;
  }

  #menu-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    padding: 20px;
    border-radius: 10px;
    color: #fff;
    margin-left: 10px;
    margin-right: 10px;
    flex-direction: row;
  
    /* Habilitar scroll pero ocultar la barra */
    overflow-y: scroll;
    max-height: 80vh;
    
    /* Ocultar scroll */
    scrollbar-width: none;
  }
  
  #menu-container::-webkit-scrollbar {
    display: none; /* Para navegadores basados en WebKit (Chrome, Safari) */
  }
  #default-message {
  width: 100%;
  height: 80vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  color: #ffffff;
  font-family: Arial, sans-serif;
  text-align: center;
}
.logo {
    background-color: transparent;
    border: none;
    cursor: pointer;
    margin-left: 30%;
}
  }

@media screen  and (max-width: 767px) {
  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    flex-wrap: nowrap;
}
.main-container {
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: center;
    flex-direction: column-reverse;
    flex-wrap: nowrap;
}
.logo {
    background-color: transparent;
    border: none;
    cursor: pointer;
    margin-left: 30%;
}
}
  </style>
</head>
<body>
  <!-- Barra de carga -->
  <div id="loading-bar"></div>
  <!-- Fin de la barra de carga -->
  <header>
    <div id="profile-icon" class="icon"><a class="ancord-nav" style="color: #ffff;" href="/"><i class="fa-solid fa-house fa-lg"></i></a></div>
    <a class="logo" href="/"><img src="src/EnmaManualidadesLogo.png" alt="Enma Manualidades"></a>
    <button id="copy-url-button">
      <i class="fa-solid fa-share-from-square"></i>
      </button>
  </header>

  <main>
<!-- Mensaje predeterminado -->
<div id="default-message">
<!-- Título -->
<h1 style="font-size: 3rem; margin: 40px; color: #d69928;">PRODUCTO NO ENCONTRADO <i class="fa-regular fa-circle-xmark fa-lg"></i></h1>

<!-- Subtítulo -->
<p style="font-size: 1.5rem; margin: 10px 0;">
    Buscar otro producto en
<a href="/" style="color: #3366CC;">Catalogo</a>
</p>
<br>
<br>
<!-- Icono de búsqueda con Font Awesome -->
<div style="margin: 50px 50px;">
    <i class="fa-solid fa-magnifying-glass fa-2xl" style="font-size: 10rem; color: #c48330;"></i>
</div>
<br>
<br>
<!-- Contacto -->
<p style="font-size: 1.2rem; color: #ffffff;">
    Contacto en <span style="color: #6bbb61; font-weight: bold;">whatsapp <i class="fa-brands fa-whatsapp fa-lg"></i> 642 70 25 29</span>
</p>
</div>



    
    <script>
      const defaultMessage = document.getElementById("default-message");
      const productContainer = document.querySelector(".product-container");
  
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            defaultMessage.style.display = "none";
          }
        });
      });
  
      if (productContainer) {
        observer.observe(productContainer);
      }
  
      const hash = window.location.hash;
      const productDetails = document.getElementById("product-details");
  
      if (!hash || hash.length <= 1) {
        defaultMessage.style.display = "block";
        productDetails.style.display = "none";
      } else {
        const productId = hash.slice(9);
        fetch("productos.json")
          .then(response => response.json())
          .then(data => {
            const product = data.find(p => p.id == productId);
            if (product) {
              renderProductDetails(productId);
              productDetails.style.display = "block";
            } else {
              defaultMessage.style.display = "block";
              productDetails.style.display = "none";
            }
          })
          .catch(() => {
            defaultMessage.style.display = "none";
            productDetails.style.display = "block";
          });
      }
  
      function renderProductDetails(productId) {
        productDetails.innerHTML = `<h1>Detalles del Producto ${productId}</h1>`;
      }
    </script>
    <script>
      document.getElementById("copy-url-button").addEventListener("click", function() {
        const productUrl = window.location.href; // Obtiene la URL completa, incluidas las partes después del '#'
        
        navigator.clipboard.writeText(productUrl).then(() => {
          // La URL se ha copiado al portapapeles sin mostrar alerta
        }).catch(err => {
          console.error("Error al copiar la URL: ", err);  // Manejo de errores
        });
      });

    </script>
    
    <div id="product-details"></div>

  
  <div style="display: none;"class="main-container">
    <!-- Vista previa -->
    <div  class="preview-container">
      <h2>Vista previa</h2>
      <p>Hazte una idea de cómo se verá tu producto.</p>
      <div class="preview">
        <img id="shirt-image" src="src/camisas.png" alt="Camiseta">
        <img id="design-preview" class="design-preview" src="src/EnmaManualidadesLogoMini.png" alt="Diseño">
      </div>
    </div>

    <!-- Controles -->
    <div class="control-panel">
      <h3>Personalizar</h3>
      <label for="upload-design">Subir diseño (PNG)</label>
      <input type="file" id="upload-design" accept="image/png">
      
      <script>
        document.getElementById("upload-design").addEventListener("change", function(event) {
          // Verificamos si el archivo fue seleccionado
          const file = event.target.files[0];
          
          if (file) {
            // Creamos un objeto URL para la imagen seleccionada
            const reader = new FileReader();
            
            // Cuando la imagen es cargada, actualizamos el src del img
            reader.onload = function(e) {
              const designPreviewImage = document.getElementById("design-preview");
              designPreviewImage.src = e.target.result;  // Establece la nueva imagen
            };
            
            // Leemos la imagen como una URL de datos
            reader.readAsDataURL(file);
          }
        });
      </script>
      <label for="design-size">Tamaño del diseño (px)</label>
      <input type="range" id="design-size" min="20" max="200" value="150">

      <label for="design-position-x">Posición X (px)</label>
      <input type="range" id="design-position-x" min="0" max="300" value="150">

      <label for="design-position-y">Posición Y (px)</label>
      <input type="range" id="design-position-y" min="0" max="300" value="150">
      <script>
        document.getElementById("design-size").addEventListener("input", function() {
          const size = this.value; // Obtiene el tamaño de diseño
          const designPreviewImage = document.getElementById("design-preview");
          
          // Establece el tamaño de la imagen (en píxeles)
          designPreviewImage.style.width = `${size}px`;
          designPreviewImage.style.height = `${size}px`; // Para mantener la proporción de la imagen
        });

        document.getElementById("design-position-x").addEventListener("input", function() {
          const positionX = this.value; // Obtiene la posición X
          const designPreviewImage = document.getElementById("design-preview");
          
          // Establece la posición en el eje X
          designPreviewImage.style.left = `${positionX}px`;
        });

        document.getElementById("design-position-y").addEventListener("input", function() {
          const positionY = this.value; // Obtiene la posición Y
          const designPreviewImage = document.getElementById("design-preview");
          
          // Establece la posición en el eje Y
          designPreviewImage.style.top = `${positionY}px`;
        });
      </script>
    </div>
  </div>  
</main>
<div id="cart-modal" class="hidden">
  <div class="modal-content">
    <span id="close-modal">&times;</span>
    <h2>Carrito de compras</h2>
    <!-- Aquí va el resumen del producto y un botón de confirmación -->
    <button id="confirm-purchase" class="cart-button">Confirmar compra</button>
  </div>
  
</div>

<button id="back-to-store">Volver a la tienda</button>
  <footer>
    <iframe class="iframefootermap" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d410404.8590365639!2d-6.423374270709594!3d36.52304662488185!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x644bb9ec6abaa235%3A0x4fd198efdf8fa5dc!2sEnma%20Manualidades!5e0!3m2!1ses!2ses!4v1702396602259!5m2!1ses!2ses" width="230" height="180" style="border-radius:20px;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    
    <div class="footer-container">
      <div class="footer-logo">
        <img width="100px" src="src/EnmaManualidadesLogoMini.png" alt="Enma Manualidades Logo">
      </div>
    </div>


    <nav class="footer-info" >
      <a href="/">Home</a> |
      <a href="/">Catálogo</a> |
      <a href="AboutMe.html#whatsapp-section">Contacto</a> |
      <a href="AboutMe.html">About Enma</a>
  </nav>
  
    <div class="footer-info">
      
      <p>&copy; 2024 Enma Manualidades. Todos los derechos reservados.</p>
      <p>Dirección: [Cádiz, Spain]</p>
      <p>Teléfono: [+34 642 70 25 29]</p>
      <p>Página Web creada Por: <a href="https://github.com/AgustinBeniteez" target="_blank">Agustin benitez</a></p>
    </div>
  </footer>
  <script>
    // Leer el ID del producto desde la URL
    const productId = window.location.hash.slice(9) || "9999"; // Si no hay ID, usa la predeterminada 9999
    console.log("Producto ID:", productId);  // Para depuración

    const productDetailsContainer = document.getElementById("product-details");
    const backToStoreButton = document.getElementById("back-to-store");
  
    let products = [];
    let provinces = [];
    let municipalities = {};

    // Producto predeterminado
    const DEFAULT_PRODUCT = {
        id: "9999",
        title: "Producto no encontrado",
        description: "Lo sentimos, no pudimos encontrar este producto.",
        price: "", // Sin precio para ID 9999
        imgUrl: "src/imagen_no_disponible.png", // Ruta de la imagen predeterminada
        shirtImageUrl: "NoTienePersonaliacionWeb",
        thumbnails: []
    };
  
    // Cargar productos desde el archivo JSON
    fetch("productos.json")
        .then((response) => {
            if (!response.ok) {
                throw new Error("Error al cargar el archivo JSON");
            }
            return response.json();
        })
        .then((data) => {
            products = data;
            renderProductDetails(productId);
        })
        .catch((error) => {
            console.error("Hubo un problema con la carga del JSON:", error);
            renderProductDetails("9999"); // Renderiza el producto predeterminado en caso de error
        });
  
    function renderProductDetails(id) {
        const product = products.find(p => p.id == id) || DEFAULT_PRODUCT; // Busca el producto o usa el predeterminado
  
        if (product) {
            // Cambiar el título del HTML
            document.title = product.title;

            // Actualizar las etiquetas meta
            updateMetaTags(product);

            const productDetails = document.getElementById("product-details");

            // Limpiar contenido previo
            productDetails.innerHTML = "";

            // Imagen principal: Si no hay imagen personalizada, usa imgUrl
            const mainImageUrl = product.imgUrl;

            // Crear HTML dinámicamente
            productDetails.innerHTML = `
                <div class="product-container">
                    <div class="product-gallery">
                        <img id="main-image" src="${mainImageUrl}" alt="${product.title}">
                        <div class="thumbnail-gallery"></div>
                    </div>
                    <div class="product-info">
                        <h1 id="product-title">${product.title}</h1>
                        ${product.id !== "9999" ? `<p id="product-id">ID: ${product.id}</p>` : ""} <!-- Mostrar ID solo si no es 9999 -->
                        <p id="product-description">${product.description}</p>
                        <p id="product-price" class="price">${product.id === "9999" ? "" : product.price + "€"}</p>
                        <button id="add-to-cart-button" class="cart-button" style="display: ${product.id === "9999" ? "none" : "block"};">
                            <i class="fas fa-shopping-cart"></i> Pedir Producto
                        </button>
                        <div id="purchase-info" class="purchase-info" style="display: ${product.id === "9999" ? "none" : "block"};">
                            <p style="font-size: 0.9em; color: #9b9b9b;">La compra se pagará a la hora de entregar el producto (excepto en casos especiales).</p>
                            <p style="font-size: 0.9em; color: #9b9b9b;">Cuando recibamos sus datos, nos pondremos en contacto por <span style="color: green;">WhatsApp <i class="fa-brands fa-whatsapp"></i></span> mediante el teléfono proporcionado para pedir detalles como: color, nombre, imágenes, etc. (si son necesarios para la personalización).</p>
                        </div>
                    </div>
                </div>
            `;

            // Manejar miniaturas dinámicamente
            const thumbnailGallery = productDetails.querySelector(".thumbnail-gallery");
            if (product.thumbnails && product.thumbnails.length > 0) {
                product.thumbnails.forEach(src => {
                    const img = document.createElement("img");
                    img.src = src;
                    img.alt = "Miniatura";
                    img.addEventListener("click", () => {
                        document.getElementById("main-image").src = src;
                    });
                    thumbnailGallery.appendChild(img);
                });
            } else {
                console.log("Este producto no tiene miniaturas.");
            }

            // Si el producto no tiene personalización web, ocultar la vista previa
            const mainContainer = document.querySelector(".main-container");
            if (mainContainer) {
                if (product.shirtImageUrl === "NoTienePersonaliacionWeb" || product.shirtImageUrl === "") {
                    const shirtImage = document.getElementById("shirt-image");
                    if (shirtImage) {
                        shirtImage.src = product.imgUrl || "NoFound.png"; // Establecer imagen predeterminada
                    }
                    mainContainer.style.display = "none"; // Ocultar la vista previa
                } else {
                    mainContainer.style.display = "flex"; // Mostrar la vista previa
                }
            }

            // Restaurar la imagen de la camiseta
            const shirtImage = document.getElementById("shirt-image");
            if (shirtImage) {
                shirtImage.src = product.shirtImageUrl || "NoFound.png"; // Usar predeterminada si no está definida
            }

            // Agregar evento para el botón de carrito solo si no está oculto
            const addToCartButton = document.getElementById("add-to-cart-button");
            if (addToCartButton.style.display !== "none") {
                addToCartButton.addEventListener("click", () => {
                    cartModal.style.display = "block";
                    document.getElementById("product-name").value = product.title;
                });
            }
        }
    }


    function updateMetaTags(product) {
      // Actualizar meta descripción
      let metaDescription = document.querySelector('meta[name="description"]');
      if (!metaDescription) {
        metaDescription = document.createElement("meta");
        metaDescription.name = "description";
        document.head.appendChild(metaDescription);
      }
      metaDescription.content = product.description;
  
      // Actualizar Open Graph (OG) tags
      let ogTitle = document.querySelector('meta[property="og:title"]');
      if (!ogTitle) {
        ogTitle = document.createElement("meta");
        ogTitle.setAttribute("property", "og:title");
        document.head.appendChild(ogTitle);
      }
      ogTitle.content = product.title;
  
      let ogDescription = document.querySelector('meta[property="og:description"]');
      if (!ogDescription) {
        ogDescription = document.createElement("meta");
        ogDescription.setAttribute("property", "og:description");
        document.head.appendChild(ogDescription);
      }
      ogDescription.content = product.description;
  
      let ogImage = document.querySelector('meta[property="og:image"]');
      if (!ogImage) {
        ogImage = document.createElement("meta");
        ogImage.setAttribute("property", "og:image");
        document.head.appendChild(ogImage);
      }
      ogImage.content = product.imgUrl;
  
      // Actualizar Twitter meta tags
      let twitterTitle = document.querySelector('meta[name="twitter:title"]');
      if (!twitterTitle) {
        twitterTitle = document.createElement("meta");
        twitterTitle.name = "twitter:title";
        document.head.appendChild(twitterTitle);
      }
      twitterTitle.content = product.title;
  
      let twitterDescription = document.querySelector('meta[name="twitter:description"]');
      if (!twitterDescription) {
        twitterDescription = document.createElement("meta");
        twitterDescription.name = "twitter:description";
        document.head.appendChild(twitterDescription);
      }
      twitterDescription.content = product.description;
  
      let twitterImage = document.querySelector('meta[name="twitter:image"]');
      if (!twitterImage) {
        twitterImage = document.createElement("meta");
        twitterImage.name = "twitter:image";
        document.head.appendChild(twitterImage);
      }
      twitterImage.content = product.imgUrl;
    }
  
    // Modal para carrito con formulario personalizado
    const cartModal = document.createElement("div");
    cartModal.id = "cart-modal";
    cartModal.innerHTML = `
      <div class="modal-content">
        <img style= "height: 100px;" src="src/EnmaManualidadesLogo.png" alt="Enma Manualidades">
        <form action="https://formspree.io/f/mbljenpz" method="POST">
          <h3 style="color: #ffff;">Solicitud de Pedido</h3>
          <label>
            Producto:
            <input type="text" name="product" id="product-name" readonly>
          </label>
          <label>
            Cantidad:
            <input type="number" name="quantity" id="quantity" value="1" min="1" required>
          </label>
          <label>
            Número de teléfono:
            <input type="tel" name="phone" id="phone" required title="Por favor ingresa un número de teléfono válido (por ejemplo, 612345678 o +34612345678)" placeholder="Ejemplo: 612 34 56 78">
          </label>
          <label>
            Provincia:
            <input type="text" name="province" id="province-input" placeholder="Escribe una provincia" required>
            <ul id="province-list" style="display:none;"></ul>
          </label>
          <label>
            Municipio:
            <input type="text" name="municipality" id="municipality-input" placeholder="Escribe un municipio" required>
            <ul id="municipality-list" style="display:none;"></ul>
          </label>
          <div id="purchase-info-popup" class="purchase-info-popup" style="font-size: 0.9em; color: #cfcfcf;">
            <p>La compra se pagará a la hora de entregar el producto (excepto en casos especiales).</p>
            <p>Cuando recibamos sus datos, nos pondremos en contacto por <span style="color: green;">WhatsApp <i class="fa-brands fa-whatsapp"></i></span> mediante el teléfono proporcionado para pedir detalles como: color, nombre, imágenes, etc. (si son necesarios para la personalización).</p>
          </div>
          <button type="submit">Confirmar Pedido&nbsp;&nbsp;<i class="fa-solid fa-paper-plane"></i></button>
        </form>
      </div>
    `;
    document.body.appendChild(cartModal);
  
    // Cerrar modal si el usuario hace clic fuera del modal
    window.addEventListener("click", (event) => {
      if (event.target === cartModal) {
        cartModal.style.display = "none";  // Cerrar modal al hacer clic fuera
      }
    });
  
    // Volver a la tienda
    backToStoreButton.addEventListener('click', () => {
      window.location.href = "index.html";  // Redirigir a la página principal
    });
  
    // Función para cargar las provincias y municipios
    function loadProvinces() {
      fetch("provincias_y_municipios.json")
        .then(response => response.json())
        .then(data => {
          provinces = data.provinces;
          municipalities = data.municipalities;
          const provinceInput = document.getElementById("province-input");
          const municipalityInput = document.getElementById("municipality-input");
          const provinceList = document.getElementById("province-list");
          const municipalityList = document.getElementById("municipality-list");
  
          // Filtrar provincias al escribir
          provinceInput.addEventListener("input", function() {
            const inputValue = removeAccents(provinceInput.value).toLowerCase();
            provinceList.innerHTML = '';
  
            provinces.forEach(province => {
              if (removeAccents(province).toLowerCase().includes(inputValue)) {
                const li = document.createElement("li");
                li.textContent = province;
                li.addEventListener("click", function() {
                  provinceInput.value = province;
                  provinceList.style.display = "none";
                });
                provinceList.appendChild(li);
              }
            });
            provinceList.style.display = provinceInput.value ? "block" : "none";
          });
  
          // Filtrar municipios al escribir
          municipalityInput.addEventListener("input", function() {
            const inputValue = removeAccents(municipalityInput.value).toLowerCase();
            municipalityList.innerHTML = '';
            const selectedProvince = provinceInput.value;
            
            if (selectedProvince && municipalities[selectedProvince]) {
              municipalities[selectedProvince].forEach(municipality => {
                if (removeAccents(municipality).toLowerCase().includes(inputValue)) {
                  const li = document.createElement("li");
                  li.textContent = municipality;
                  li.addEventListener("click", function() {
                    municipalityInput.value = municipality;
                    municipalityList.style.display = "none";
                  });
                  municipalityList.appendChild(li);
                }
              });
            }
            municipalityList.style.display = municipalityInput.value ? "block" : "none";
          });
        });
    }
  
    // Eliminar acentos para una comparación insensible a las tildes
    function removeAccents(str) {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

// Cambiar logo y fondo si es temporada navideña
(function() {
        const today = new Date(); // Puedes usar new Date('2025-02-14') para hacer pruebas

        // Fechas de Navidad (1 diciembre - 10 enero)
        const startNavidad = new Date(today.getFullYear(), 11, 1); // 1 de diciembre
        const endNavidad = new Date(today.getFullYear() + 1, 0, 10); // 10 de enero del siguiente año

        // Fechas de San Valentín (semana del 14 de febrero)
        const sanValentinStart = new Date(today.getFullYear(), 1, 7); // Lunes de la semana del 14 de febrero
        const sanValentinEnd = new Date(today.getFullYear(), 1, 20); // Domingo de la semana del 14 de febrero

        // Fechas de Black Friday (semana antes del último viernes de noviembre)
        const lastDayNov = new Date(today.getFullYear(), 10, 30); // El último día de noviembre
        const blackFridayStart = new Date(lastDayNov.getFullYear(), lastDayNov.getMonth(), lastDayNov.getDate() - 7); // Lunes antes del último viernes
        const blackFridayEnd = new Date(lastDayNov.getFullYear(), lastDayNov.getMonth(), lastDayNov.getDate()); // Domingo del último día de noviembre

        // Fechas de Comuniones (finales de marzo hasta finales de mayo)
        const comunionesStart = new Date(today.getFullYear(), 2, 31); // Último día de marzo
        const comunionesEnd = new Date(today.getFullYear(), 4, 31); // Último día de mayo

        // Variables para verificar las temporadas
        const isNavidad = today >= startNavidad && today <= endNavidad;
        const isSanValentin = today >= sanValentinStart && today <= sanValentinEnd;
        const isBlackFriday = today >= blackFridayStart && today <= blackFridayEnd;
        const isComuniones = today >= comunionesStart && today <= comunionesEnd;

        // Cambiar el logo, fondo y estilos dependiendo de la temporada
        if (isNavidad) {
            // Cambiar el logo de Navidad
            const logoImg = document.querySelector('a.logo img');
            if (logoImg) {
                logoImg.src = 'TEMPORADAS/Temporada Navidad/EnmaManualidadesNavidadLogo.png';
            }

            // Cambiar el fondo y estilos para Navidad
            document.body.style.background = 'linear-gradient(0deg, rgb(97, 86, 67) 0%, rgb(77, 11, 70) 100%)';
            document.querySelectorAll('h1, h2, h3').forEach(heading => heading.style.setProperty('color', '#e1c99b', 'important'));
            const previewContainer = document.querySelector('.preview-container');
            if (previewContainer) previewContainer.style.backgroundColor = '#500e47';
            const controlPanel = document.querySelector('.control-panel');
            if (controlPanel) controlPanel.style.backgroundColor = '#500e47';

            // Cambiar color de la barra de carga
            const loadingBar = document.getElementById('loading-bar');
            if (loadingBar) loadingBar.style.backgroundColor = 'rgb(225, 201, 155)'; // Navidad: color dorado

        } else if (isSanValentin) {
            // Cambiar el logo de San Valentín
            const logoImg = document.querySelector('a.logo img');
            if (logoImg) {
                logoImg.src = 'TEMPORADAS/San Valentin/EnmaManualidadesSanValentinLogo.png';
            }

            // Cambiar el fondo y estilos para San Valentín
            document.body.style.background = 'linear-gradient(1.48deg, rgba(225, 0, 82, 1) 0%, rgba(37, 1, 34, 1) 100%)';
            document.querySelectorAll('h1, h2, h3').forEach(heading => heading.style.setProperty('color', '#ffffff', 'important'));
            const previewContainer = document.querySelector('.preview-container');
            if (previewContainer) previewContainer.style.backgroundColor = '#d5004c';
            const controlPanel = document.querySelector('.control-panel');
            if (controlPanel) controlPanel.style.backgroundColor = '#d5004c';

            // Cambiar color de la barra de carga
            const loadingBar = document.getElementById('loading-bar');
            if (loadingBar) loadingBar.style.backgroundColor = '#ff0066'; // San Valentín: color anaranjado

        } else if (isBlackFriday) {
            // Cambiar el logo de Black Friday
            const logoImg = document.querySelector('a.logo img');
            if (logoImg) {
                logoImg.src = 'TEMPORADAS/BLACK FRIDAY/EnmaManualidadesBlackFridayLogo.png';
            }

            // Cambiar el fondo y estilos para Black Friday
            document.body.style.background = 'conic-gradient(from 149.48deg at 50% 50%, rgba(0, 0, 0, 1) 0%, rgba(200, 200, 200, 1) 100%)';
            document.querySelectorAll('h1, h2, h3').forEach(heading => heading.style.setProperty('color', '#fff', 'important'));
            const previewContainer = document.querySelector('.preview-container');
            if (previewContainer) previewContainer.style.backgroundColor = '#000';
            const controlPanel = document.querySelector('.control-panel');
            if (controlPanel) controlPanel.style.backgroundColor = '#000';

            // Cambiar color de la barra de carga
            const loadingBar = document.getElementById('loading-bar');
            if (loadingBar) loadingBar.style.backgroundColor = '#000'; // Black Friday: color negro

        } else if (isComuniones) {
            // Cambiar el logo de Comuniones
            const logoImg = document.querySelector('a.logo img');
            if (logoImg) {
                logoImg.src = 'TEMPORADAS/Comuniones/EnmaManualidadesComunionesLogo.png';
            }

            // Cambiar el fondo y estilos para Comuniones
            document.body.style.background = 'linear-gradient(0deg, rgba(202, 169, 106, 1) 0%, rgba(106, 168, 210, 1) 100%)';
            document.querySelectorAll('h1, h2, h3').forEach(heading => heading.style.setProperty('color', '#ffffff', 'important'));
            const previewContainer = document.querySelector('.preview-container');
            if (previewContainer) previewContainer.style.backgroundColor = '#1f63a6';
            const controlPanel = document.querySelector('.control-panel');
            if (controlPanel) controlPanel.style.backgroundColor = '#1f63a6';

            // Cambiar color de la barra de carga
            const loadingBar = document.getElementById('loading-bar');
            if (loadingBar) loadingBar.style.backgroundColor = '#1f63a6'; // Comuniones: color azul

        }

        // Animación de la barra de carga
        function loadingAnimation() {
            const loadingBar = document.getElementById('loading-bar');
            if (!loadingBar) return;

            loadingBar.style.width = '0%'; // Inicialmente en 0%
            setTimeout(() => {
                loadingBar.style.transition = 'width 1s ease-out'; // Transición suave
                loadingBar.style.width = '100%'; // Llega al 100%
            }, 300); // Retardo inicial para empezar la animación
        }

        // Iniciar la animación de la barra de carga
        loadingAnimation();

        // Desaparecer la barra cuando la carga termine
        window.addEventListener('load', () => {
            const loadingBar = document.getElementById('loading-bar');
            if (loadingBar) {
                setTimeout(() => {
                    loadingBar.style.transition = 'width 0.5s ease-out'; // Transición suave para desaparecer
                    setTimeout(() => {
                        loadingBar.style.width = '0%'; // Desaparece después de que llegue al 100%
                    }, 500); // Después de un pequeño retraso para dar el efecto de desaparecer
                }, 300); // Retardo para asegurar que la animación se inicie
            }
        });

    })();   // Cargar provincias al inicio
    loadProvinces();
  </script>
  
</body>
</html>
